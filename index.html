<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ZENZO Forge</title>
  </head>
  <body style="
    margin: 0;
    height: 100%;
    padding: 0;
    background-color: #48dfe1;
    overflow-x: hidden;
    overflow-y: auto;
    color: white;
    font-family: cursive;">
    
    <div style="
      height: 100vh;
      background-image: linear-gradient(180deg, #8678dc, #48dfe1);">

      <h1 style="text-align: center;font-family: cursive;margin-top: 0;padding-top: 25px;">ZENZO Forge Inventory</h1>
      <p style="text-align: center;font-family: cursive;">Peers: <b id="peerCount">0</b></p>
      <br>
      <span id="items"></span>

      <div style="text-align: center;margin-top: 50px;">
        <h2>Create a Decentralized ZNZ-Backed Asset</h2>
        <p>Name: </p><input id="new_item_name" type="text">
        <p>Value: </p><input id="new_item_value" type="number">
        <br>
        <input type="button" value="Craft" onclick="craftItem()">
      </div>

      <!-- FORGE LIBRARY GOES BELOW -->
      <script src="./index.js"></script>
      <!-- FORGE LIBRARY GOES ABOVE -->

      <script>
          function craftItem() {
            let nName = document.getElementById("new_item_name").value;
            let nValue = Number(document.getElementById("new_item_value").value);

            craftForgeItem(nName, nValue);
          }

          function craftForgeItem (name, value) {
              superagent
              .post('http://127.0.0.1:80/forge/create')
              .send({ amount: value, name: name, auth: authToken})
              .end((err, res) => {
                console.info(res);
                refreshInventory();
              });
          }

          async function getForgeInventory (addr) {
              let inv = {items: [], pendingItems: []};
              let res = await superagent.post('http://127.0.0.1:80/forge/items');
              res = JSON.parse(res.text);
              for (let i=0; i<res.items.length; i++) {
                if (res.items[i].address === addr) inv.items.push(res.items[i]);
              }
              for (let i=0; i<res.pendingItems.length; i++) {
                if (res.pendingItems[i].address === addr) inv.pendingItems.push(res.pendingItems[i]);
              }
              return inv;
          }

          function refreshInventory() {
            getForgeInventory(addy).then(inv => {
              let itemHTML = "<br>";
              for (let i=0; i<inv.items.length; i++) {
                itemHTML += '<div style="display: inline-block;border-style: solid;border-width: 2px;border-radius: 7px;padding: 10px;margin: 10px;">' + "<b>Name:<b/> " + inv.items[i].name + '<br><b>Value: </b>' + inv.items[i].value + '</div>';
              }
              for (let i=0; i<inv.pendingItems.length; i++) {
                itemHTML += '<div style="display: inline-block;border-style: solid;border-width: 2px;border-radius: 7px;padding: 10px;margin: 10px;opacity: 0.5;">' + "<b>Name:<b/> " + inv.pendingItems[i].name + '<br><b>Value: </b>' + inv.pendingItems[i].value + '</div>';
              }
              document.getElementById("items").innerHTML = itemHTML;
            });
          }


          setInterval(function() {
            document.getElementById("peerCount").innerHTML = peers.length;
            refreshInventory();
          }, 1000);

          refreshInventory();
      </script>
    </div>
  </body>
</html>
